@model RaceEvents.Models.Event
@{
    ViewData["Title"] = "Детали события";
    var userId = Context.Session.GetInt32("UserId");
    var userRole = Context.Session.GetString("UserRole");
    var isAdmin = userRole == "ADMINISTRATOR";
}

<h2>@Model.Title</h2>

<div>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">Описание</dt>
        <dd class="col-sm-10">@(Model.Description ?? "-")</dd>

        <dt class="col-sm-2">Дата и время</dt>
        <dd class="col-sm-10">@Model.Date.ToString("dd.MM.yyyy HH:mm")</dd>

        <dt class="col-sm-2">Место проведения</dt>
        <dd class="col-sm-10">@Model.Location</dd>

        <dt class="col-sm-2">Тип трассы</dt>
        <dd class="col-sm-10">@Model.TrackType</dd>

        <dt class="col-sm-2">Тип события</dt>
        <dd class="col-sm-10">
            @(Model.Type == RaceEvents.Models.Enums.EventType.WINTER ? "ЗИМНИЙ" :
              Model.Type == RaceEvents.Models.Enums.EventType.SUMMER ? "ЛЕТНИЙ" :
              Model.Type == RaceEvents.Models.Enums.EventType.TRACK_DAY ? "ТРЕК ДЕНЬ" : Model.Type.ToString())
        </dd>

        <dt class="col-sm-2">Статус</dt>
        <dd class="col-sm-10">
            @(Model.Status == RaceEvents.Models.Enums.EventStatus.UPCOMING ? "ПРЕДСТОЯЩЕЕ" :
              Model.Status == RaceEvents.Models.Enums.EventStatus.REGISTRATION_OPEN ? "РЕГИСТРАЦИЯ ОТКРЫТА" :
              Model.Status == RaceEvents.Models.Enums.EventStatus.IN_PROGRESS ? "В ПРОЦЕССЕ" :
              Model.Status == RaceEvents.Models.Enums.EventStatus.COMPLETED ? "ЗАВЕРШЕНО" :
              Model.Status == RaceEvents.Models.Enums.EventStatus.CANCELLED ? "ОТМЕНЕНО" : Model.Status.ToString())
        </dd>

        <dt class="col-sm-2">Максимум участников</dt>
        <dd class="col-sm-10">@Model.MaxParticipants</dd>

        <dt class="col-sm-2">Требование к автомобилю</dt>
        <dd class="col-sm-10">
            @(Model.CarTypeRequirement == RaceEvents.Models.Enums.CarTypeRequirement.ANY ? "ЛЮБОЙ" :
              Model.CarTypeRequirement == RaceEvents.Models.Enums.CarTypeRequirement.SPECIFIC_CLASS ? "ОПРЕДЕЛЕННЫЙ КЛАСС" : Model.CarTypeRequirement.ToString())
        </dd>

        @if (Model.CarTypeRequirement == RaceEvents.Models.Enums.CarTypeRequirement.SPECIFIC_CLASS)
        {
            <dt class="col-sm-2">Требуемый класс</dt>
            <dd class="col-sm-10">@Model.RequiredCarClass</dd>
        }

        @if (Model.MaxHorsepower.HasValue)
        {
            <dt class="col-sm-2">Макс. мощность</dt>
            <dd class="col-sm-10">@Model.MaxHorsepower л.с.</dd>
        }

        @if (!string.IsNullOrEmpty(Model.RequiredDriveType))
        {
            <dt class="col-sm-2">Требуемый привод</dt>
            <dd class="col-sm-10">@Model.RequiredDriveType</dd>
        }

        @if (Model.Championship != null)
        {
            <dt class="col-sm-2">Чемпионат</dt>
            <dd class="col-sm-10">@Model.Championship.Title</dd>
        }

        <dt class="col-sm-2">Организатор</dt>
        <dd class="col-sm-10">@Model.Administrator.FirstName @Model.Administrator.LastName</dd>
    </dl>
</div>

<div>
    @if (isAdmin && Model.AdministratorId == userId)
    {
        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-primary">Редактировать</a>
        <div class="btn-group mt-2" role="group">
            <form asp-action="ChangeStatus" method="post" class="d-inline">
                <input type="hidden" name="id" value="@Model.Id" />
                <select name="status" class="form-select d-inline-block" style="width: auto;" onchange="this.form.submit()">
                    @if (Model.Status == RaceEvents.Models.Enums.EventStatus.UPCOMING)
                    {
                        <option value="UPCOMING" selected>ПРЕДСТОЯЩЕЕ</option>
                    }
                    else
                    {
                        <option value="UPCOMING">ПРЕДСТОЯЩЕЕ</option>
                    }
                    @if (Model.Status == RaceEvents.Models.Enums.EventStatus.REGISTRATION_OPEN)
                    {
                        <option value="REGISTRATION_OPEN" selected>РЕГИСТРАЦИЯ ОТКРЫТА</option>
                    }
                    else
                    {
                        <option value="REGISTRATION_OPEN">РЕГИСТРАЦИЯ ОТКРЫТА</option>
                    }
                    @if (Model.Status == RaceEvents.Models.Enums.EventStatus.IN_PROGRESS)
                    {
                        <option value="IN_PROGRESS" selected>В ПРОЦЕССЕ</option>
                    }
                    else
                    {
                        <option value="IN_PROGRESS">В ПРОЦЕССЕ</option>
                    }
                    @if (Model.Status == RaceEvents.Models.Enums.EventStatus.COMPLETED)
                    {
                        <option value="COMPLETED" selected>ЗАВЕРШЕНО</option>
                    }
                    else
                    {
                        <option value="COMPLETED">ЗАВЕРШЕНО</option>
                    }
                    @if (Model.Status == RaceEvents.Models.Enums.EventStatus.CANCELLED)
                    {
                        <option value="CANCELLED" selected>ОТМЕНЕНО</option>
                    }
                    else
                    {
                        <option value="CANCELLED">ОТМЕНЕНО</option>
                    }
                </select>
                @Html.AntiForgeryToken()
            </form>
        </div>
    }
    @if (!isAdmin && userId != null && Model.Status == RaceEvents.Models.Enums.EventStatus.REGISTRATION_OPEN)
    {
        <a asp-controller="Applications" asp-action="Create" asp-route-eventId="@Model.Id" class="btn btn-success">Подать заявку</a>
    }
    <a asp-action="Index" class="btn btn-secondary">Назад к списку</a>
</div>

